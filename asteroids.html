<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Space Explorer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        .game-container {
            position: relative;
            background: radial-gradient(ellipse at center, #0a0a23 0%, #000000 70%);
            border: 3px solid #00ffff;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3), inset 0 0 20px rgba(0, 255, 255, 0.1);
        }

        #gameCanvas {
            display: block;
            border-radius: 7px;
        }

        .ui {
            position: absolute;
            top: 15px;
            left: 15px;
            color: #00ffff;
            font-size: 18px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            z-index: 10;
        }

        .controls {
            position: absolute;
            bottom: 15px;
            right: 15px;
            color: #00ffff;
            font-size: 12px;
            text-align: right;
            opacity: 0.7;
            z-index: 10;
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff6b6b;
            text-align: center;
            font-size: 24px;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
            z-index: 20;
            display: none;
        }

        .restart-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            border: none;
            color: white;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <div class="ui">
            <div>Score: <span id="score">0</span></div>
            <div>Level: <span id="level">1</span></div>
            <div>Lives: <span id="lives">3</span></div>
        </div>

        <div class="controls">
            <div>A/D or ← → to move left/right</div>
            <div>W/S or ↑ ↓ to move up/down</div>
            <div>Hold SPACEBAR for continuous fire</div>
            <div>Collect gems • Avoid asteroids</div>
        </div>

        <div class="game-over" id="gameOver">
            <div>GAME OVER</div>
            <div style="font-size: 16px; margin: 10px 0;">Final Score: <span id="finalScore">0</span></div>
            <button class="restart-btn" onclick="restartGame()">Play Again</button>
        </div>
    </div>

    <script>
        // =========================
        // Settings (tweakables)
        // =========================
        const CONFIG = {
            canvas: {
                width: 800,
                height: 600,
                clearColor: 'rgba(10, 10, 35, 0.9)'
            },
            game: {
                initialScore: 0,
                initialLevel: 1,
                initialLives: 3,
                startGameOver: true
            },
            input: {
                shotCooldownMs: 50
            },
            player: {
                baseWidth: 20,
                baseHeight: 25,
                speed: 5,
                trailMax: 10,
                incSizeFactor: 0, // PlayerIncSize
                enginePulseIncrement: 1,
                colors: {
                    body: '#00ffff',
                    detail: '#ffffff',
                    engineGlow: '#ff6b6b'
                },
                enginePulse: {
                    intensityBase: 0.5,
                    intensityRange: 0.5,
                    intensityRate: 0.3,
                    alphaBase: 0.7,
                    alphaRange: 0.3,
                    alphaRate: 0.2
                }
            },
            stars: {
                count: 100,
                sizeMin: 0.5,
                sizeRange: 2,
                speedMin: 0.5,
                speedRange: 2,
                opacityMin: 0.2,
                opacityRange: 0.8
            },
            particles: {
                defaultSpeed: 3,
                explosionSpeed: 5,
                lifeDecay: 0.02,
                sizeMin: 2,
                sizeRange: 4,
                asteroidExplosionCount: 20,
                gemExplosionCount: 8
            },
            asteroid: {
                sizeMin: 20,
                sizeRange: 90,
                sidesMin: 3,
                sidesRange: 5,
                horizontalOffset: 4, // (rand-0.5)*4
                rotSpeedRange: 1, // (rand-0.5)*1
                baseSpeedMax: 2,  // Math.random() * 2
                levelSpeedFactor: 0.5, // + level * 0.5
                spawnBaseProb: 0.02,
                spawnLevelFactor: 0.005,
                color: {
                    red: 255,
                    greenMaxExclusive: 166,
                    blueMaxExclusive: 166
                }
            },
            gem: {
                width: 15,
                height: 15,
                speedMin: 3,
                speedRange: 2,
                pulseRate: 0.15,
                spawnProb: 0.015,
                colors: {
                    fill: '#ffff00',
                    glow: '#ffff00',
                    stroke: '#ffffff'
                }
            },
            laser: {
                width: 2,
                height: 15,
                speed: 12,
                color: '#00ffff',
                centerColor: '#ffffff',
                xOffset: -1
            },
            scoring: {
                gemValue: 10,
                asteroidValue: 25,
                levelUpEvery: 100
            }
        };

        // =========================
        // DOM and canvas
        // =========================
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // =========================
        // Game state
        // =========================
        let game = {
            score: CONFIG.game.initialScore,
            level: CONFIG.game.initialLevel,
            lives: CONFIG.game.initialLives,
            gameOver: CONFIG.game.startGameOver,
            particles: [],
            stars: []
        };

        // =========================
        // Player
        // =========================
        const player = {
            width: CONFIG.player.baseWidth,
            height: CONFIG.player.baseHeight,
            x: CONFIG.canvas.width / 2 - CONFIG.player.baseWidth / 2,
            y: CONFIG.canvas.height - CONFIG.player.baseHeight - CONFIG.player.baseHeight / 2,
            speed: CONFIG.player.speed,
            trail: [],
            enginePulse: 0
        };

        // =========================
        // Game objects
        // =========================
        let asteroids = [];
        let gems = [];
        let lasers = [];

        // =========================
        // Input
        // =========================
        const keys = {};
        let lastShot = 0;

        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            if (e.key === ' ') {
                keys['space'] = true;
                e.preventDefault();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
            if (e.key === ' ') {
                keys['space'] = false;
            }
        });

        // =========================
        // Utility
        // =========================
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        function getRandomRedColor() {
            const red = CONFIG.asteroid.color.red;
            const green = Math.floor(Math.random() * CONFIG.asteroid.color.greenMaxExclusive);
            const blue = Math.floor(Math.random() * CONFIG.asteroid.color.blueMaxExclusive);
            return `rgb(${red}, ${green}, ${blue})`;
        }

        // =========================
        // Background stars
        // =========================
        function initStars() {
            game.stars = [];
            for (let i = 0; i < CONFIG.stars.count; i++) {
                game.stars.push({
                    x: Math.random() * CONFIG.canvas.width,
                    y: Math.random() * CONFIG.canvas.height,
                    size: Math.random() * CONFIG.stars.sizeRange + CONFIG.stars.sizeMin,
                    speed: Math.random() * CONFIG.stars.speedRange + CONFIG.stars.speedMin,
                    opacity: Math.random() * CONFIG.stars.opacityRange + CONFIG.stars.opacityMin
                });
            }
        }

        function updateStars() {
            for (const star of game.stars) {
                star.y += star.speed;
                if (star.y > CONFIG.canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * CONFIG.canvas.width;
                }
            }
        }

        function drawStars() {
            ctx.fillStyle = 'white';
            for (const star of game.stars) {
                ctx.globalAlpha = star.opacity;
                ctx.fillRect(star.x, star.y, star.size, star.size);
            }
            ctx.globalAlpha = 1;
        }

        // =========================
        // Particles
        // =========================
        function createParticle(x, y, color, speed = CONFIG.particles.defaultSpeed) {
            return {
                x,
                y,
                vx: (Math.random() - 0.5) * speed * 2,
                vy: (Math.random() - 0.5) * speed * 2,
                life: 1,
                decay: CONFIG.particles.lifeDecay,
                color,
                size: Math.random() * CONFIG.particles.sizeRange + CONFIG.particles.sizeMin
            };
        }

        function createExplosion(x, y, color, count = 15) {
            for (let i = 0; i < count; i++) {
                game.particles.push(createParticle(x, y, color, CONFIG.particles.explosionSpeed));
            }
        }

        function updateParticles() {
            for (let i = game.particles.length - 1; i >= 0; i--) {
                const p = game.particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life -= p.decay;
                p.size *= 0.98;
                if (p.life <= 0 || p.size <= 0.1) {
                    game.particles.splice(i, 1);
                }
            }
        }

        function drawParticles() {
            for (const p of game.particles) {
                ctx.save();
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x - p.size / 2, p.y - p.size / 2, p.size, p.size);
                ctx.restore();
            }
        }

        // =========================
        // Creators
        // =========================
        function createAsteroid() {
            const size = Math.random() * CONFIG.asteroid.sizeRange + CONFIG.asteroid.sizeMin;
            return {
                x: Math.random() * (CONFIG.canvas.width - size),
                y: -size,
                horizontalOffset: (Math.random() - 0.5) * CONFIG.asteroid.horizontalOffset,
                width: size,
                height: size,
                color: getRandomRedColor(),
                sides: Math.random() * CONFIG.asteroid.sidesRange + CONFIG.asteroid.sidesMin,
                speed: Math.random() * CONFIG.asteroid.baseSpeedMax + game.level * CONFIG.asteroid.levelSpeedFactor,
                rotation: 0,
                rotationSpeed: (Math.random() - 0.5) * CONFIG.asteroid.rotSpeedRange
            };
        }

        function createGem() {
            return {
                x: Math.random() * (CONFIG.canvas.width - CONFIG.gem.width),
                y: -CONFIG.gem.height,
                width: CONFIG.gem.width,
                height: CONFIG.gem.height,
                speed: Math.random() * CONFIG.gem.speedRange + CONFIG.gem.speedMin,
                pulse: 0,
                collected: false
            };
        }

        function createLaser(x, y) {
            return {
                x: x + CONFIG.laser.xOffset,
                y: y,
                width: CONFIG.laser.width,
                height: CONFIG.laser.height,
                speed: CONFIG.laser.speed,
                color: CONFIG.laser.color
            };
        }

        function shootLaser() {
            const laser = createLaser(
                player.x + player.width / 2,
                player.y
            );
            lasers.push(laser);
        }

        // =========================
        // Drawing
        // =========================
        function drawPlayer() {
            ctx.save();

            // Trail
            ctx.globalAlpha = 0.6;
            for (let i = 0; i < player.trail.length; i++) {
                const t = player.trail[i];
                ctx.fillStyle = `rgba(0, 255, 255, ${0.3 * (i / player.trail.length)})`;
                ctx.fillRect(t.x - 2, t.y - 2, 4, 4);
            }
            ctx.globalAlpha = 1;

            // Ship
            ctx.translate(player.x + player.width / 2, player.y + player.height / 2);

            ctx.fillStyle = CONFIG.player.colors.body;
            ctx.beginPath();
            ctx.moveTo(0, -player.height / 2);
            ctx.lineTo(-player.width / 2, player.height / 2);
            ctx.lineTo(0, player.width / 2);
            ctx.lineTo(player.width / 2, player.height / 2);
            ctx.closePath();
            ctx.fill();

            ctx.fillStyle = CONFIG.player.colors.detail;
            ctx.fillRect(-2, -8, 4, 8);

            // Engine glow
            const ep = CONFIG.player.enginePulse;
            const engineIntensity = ep.intensityBase + ep.intensityRange * Math.sin(player.enginePulse * ep.intensityRate);
            const engineAlpha = ep.alphaBase + ep.alphaRange * Math.sin(player.enginePulse * ep.alphaRate);

            ctx.globalAlpha = engineAlpha;
            ctx.fillStyle = `rgba(255, ${Math.floor(107 * engineIntensity)}, ${Math.floor(107 * engineIntensity)}, 1)`;
            ctx.shadowColor = CONFIG.player.colors.engineGlow;
            ctx.shadowBlur = 15 * engineIntensity;

            ctx.beginPath();
            ctx.moveTo(-player.width / 6, player.height / 2);
            ctx.lineTo(0, player.width / 2 + player.height / 2);
            ctx.lineTo(player.width / 6, player.height / 2);
            ctx.closePath();
            ctx.fill();

            ctx.shadowBlur = 0;
            ctx.globalAlpha = 1;

            ctx.restore();
        }

        function drawAsteroid(asteroid) {
            ctx.save();
            ctx.translate(asteroid.x + asteroid.width / 2, asteroid.y + asteroid.height / 2);
            ctx.rotate(asteroid.rotation);

            ctx.fillStyle = asteroid.color;
            ctx.strokeStyle = asteroid.color;
            ctx.lineWidth = 2;

            ctx.beginPath();
            const sides = asteroid.sides;
            for (let i = 0; i < sides; i++) {
                const angle = (i / sides) * Math.PI * 2;
                const radius = (asteroid.width / 2) * (0.8 + Math.sin(i * 1.5) * 0.2);
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            ctx.restore();
        }

        function drawGem(gem) {
            ctx.save();
            ctx.translate(gem.x + gem.width / 2, gem.y + gem.height / 2);

            const scale = 1 + Math.sin(gem.pulse) * 0.2;
            ctx.scale(scale, scale);

            ctx.shadowColor = CONFIG.gem.colors.glow;
            ctx.shadowBlur = 20;

            ctx.fillStyle = CONFIG.gem.colors.fill;
            ctx.strokeStyle = CONFIG.gem.colors.stroke;
            ctx.lineWidth = 2;

            ctx.beginPath();
            ctx.moveTo(0, -8);
            ctx.lineTo(6, -3);
            ctx.lineTo(6, 3);
            ctx.lineTo(0, 8);
            ctx.lineTo(-6, 3);
            ctx.lineTo(-6, -3);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            ctx.restore();
        }

        function drawLaser(laser) {
            ctx.save();
            ctx.shadowColor = laser.color;
            ctx.shadowBlur = 10;

            ctx.fillStyle = laser.color;
            ctx.fillRect(laser.x, laser.y, laser.width, laser.height);

            ctx.fillStyle = CONFIG.laser.centerColor;
            ctx.fillRect(laser.x + 0.5, laser.y, laser.width - 1, laser.height);

            ctx.restore();
        }

        // =========================
        // Updates
        // =========================
        function updatePlayer() {
            if ((keys['a'] || keys['arrowleft']) && player.x > 0) {
                player.x -= player.speed;
            }
            if ((keys['d'] || keys['arrowright']) && player.x < CONFIG.canvas.width - player.width) {
                player.x += player.speed;
            }
            if ((keys['w'] || keys['arrowup']) && player.y > 0) {
                player.y -= player.speed;
            }
            if ((keys['s'] || keys['arrowdown']) && player.y < CONFIG.canvas.height - player.height) {
                player.y += player.speed;
            }

            if (keys['space']) {
                const now = Date.now();
                if (now - lastShot > CONFIG.input.shotCooldownMs) {
                    shootLaser();
                    lastShot = now;
                }
            }

            player.enginePulse += CONFIG.player.enginePulseIncrement;

            player.trail.push({ x: player.x + player.width / 2, y: player.y });
            if (player.trail.length > CONFIG.player.trailMax) {
                player.trail.shift();
            }
        }

        function updateAsteroids() {
            for (let i = asteroids.length - 1; i >= 0; i--) {
                const a = asteroids[i];
                a.y += a.speed;
				a.x += a.horizontalOffset;
                a.rotation += a.rotationSpeed;

                if (a.y > CONFIG.canvas.height) {
                    asteroids.splice(i, 1);
                }

                if (checkCollision(player, a)) {
                    createExplosion(player.x + player.width / 2, player.y + player.height / 2, CONFIG.player.colors.engineGlow);
                    game.lives--;

                    player.x = CONFIG.canvas.width / 2 - CONFIG.player.baseWidth / 2;
                    player.y = CONFIG.canvas.height - CONFIG.player.baseHeight - CONFIG.player.baseHeight / 2;
                    player.width = CONFIG.player.baseWidth;
                    player.height = CONFIG.player.baseHeight;

                    if (game.lives <= 0) {
                        game.gameOver = true;
                    }

                    asteroids.splice(i, 1);
                }
            }

            if (Math.random() < CONFIG.asteroid.spawnBaseProb + game.level * CONFIG.asteroid.spawnLevelFactor) {
                asteroids.push(createAsteroid());
            }
        }

        function updateGems() {
            for (let i = gems.length - 1; i >= 0; i--) {
                const g = gems[i];
                g.y += g.speed;
                g.pulse += CONFIG.gem.pulseRate;

                if (g.y > CONFIG.canvas.height) {
                    gems.splice(i, 1);
                }

                if (checkCollision(player, g)) {
                    createExplosion(g.x + g.width / 2, g.y + g.height / 2, CONFIG.gem.colors.fill, CONFIG.particles.gemExplosionCount);
                    game.score += CONFIG.scoring.gemValue;
                    gems.splice(i, 1);

                    player.width += player.width * CONFIG.player.incSizeFactor;
                    player.height += player.height * CONFIG.player.incSizeFactor;

                    if (game.score % CONFIG.scoring.levelUpEvery === 0) {
                        game.level++;
                    }
                }
            }

            if (Math.random() < CONFIG.gem.spawnProb) {
                gems.push(createGem());
            }
        }

        function updateLasers() {
            for (let i = lasers.length - 1; i >= 0; i--) {
                const l = lasers[i];
                l.y -= l.speed;

                if (l.y + l.height < 0) {
                    lasers.splice(i, 1);
                    continue;
                }

                for (let j = asteroids.length - 1; j >= 0; j--) {
                    const a = asteroids[j];
                    if (checkCollision(l, a)) {
                        createExplosion(a.x + a.width / 2, a.y + a.height / 2, a.color, CONFIG.particles.asteroidExplosionCount);
                        game.score += CONFIG.scoring.asteroidValue;

                        lasers.splice(i, 1);
                        asteroids.splice(j, 1);

                        if (game.score % CONFIG.scoring.levelUpEvery === 0) {
                            game.level++;
                        }
                        break;
                    }
                }
            }
        }

        // =========================
        // UI
        // =========================
        function updateUI() {
            document.getElementById('score').textContent = game.score;
            document.getElementById('level').textContent = game.level;
            document.getElementById('lives').textContent = game.lives;

            if (game.gameOver) {
                document.getElementById('finalScore').textContent = game.score;
                document.getElementById('gameOver').style.display = 'block';
            }
        }

        // =========================
        // Main loop
        // =========================
        function gameLoop() {
            if (!game.gameOver) {
                ctx.fillStyle = CONFIG.canvas.clearColor;
                ctx.fillRect(0, 0, CONFIG.canvas.width, CONFIG.canvas.height);

                updateStars();
                updatePlayer();
                updateAsteroids();
                updateGems();
                updateLasers();
                updateParticles();

                drawStars();
                drawPlayer();

                for (const a of asteroids) drawAsteroid(a);
                for (const g of gems) drawGem(g);
                for (const l of lasers) drawLaser(l);

                drawParticles();
            }

            updateUI();
            requestAnimationFrame(gameLoop);
        }

        // =========================
        // Controls
        // =========================
        function restartGame() {
            game.score = CONFIG.game.initialScore;
            game.level = CONFIG.game.initialLevel;
            game.lives = CONFIG.game.initialLives;
            game.gameOver = false;
            game.particles = [];

            player.x = CONFIG.canvas.width / 2 - CONFIG.player.baseWidth / 2;
            player.y = CONFIG.canvas.height - CONFIG.player.baseHeight - CONFIG.player.baseHeight / 2;
            player.width = CONFIG.player.baseWidth;
            player.height = CONFIG.player.baseHeight;

            player.trail = [];
            player.enginePulse = 0;

            asteroids = [];
            lasers = [];

            document.getElementById('gameOver').style.display = 'none';

            initStars();
        }

        // =========================
        // Init
        // =========================
        initStars();
        gameLoop();
    </script>
</body>
</html>